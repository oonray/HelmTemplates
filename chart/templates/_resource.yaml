{{ define "resource" }}
{{- $env := (index . 0) }}
{{- $kind := (index . 1) }}
{{- $name := (index . 2) }}
{{- include "resource.version" $kind | trim }}
kind: {{ index . 1 }}
metadata:
{{- include "resource.metadata" $env | trim | nindent 2 }}
{{ end }}

{{ define "resource.named" }}
{{- $env := (index . 0) }}
{{- $kind := (index . 1) }}
{{- $name := (index . 2) }}
{{- if (eq $kind "Service") }}
    {{- if $env.Values.namespace.env }}
{{- $name = (printf "%s-%s-%s" $env.Chart.Name $name $env.Values.environment) }}
    {{- else }}
{{- $name = (printf "%s-%s" $env.Chart.Name $name) }}
    {{- end }}
{{- end }}
{{- include "resource.version" $kind | trim }}
kind: {{ $kind }}
metadata:
{{- include "resource.metadata.named" (list $env $name) | trim | nindent 2 }}
{{ end }}

{{ define "resource.metadata" }}
name: "{{ .Chart.Name }}-{{ .Values.environment }}"
{{ include "namespace.tag" . | trim }}
labels:
{{- include "labels" . | trim | nindent 2 }}
{{ end }}

{{ define "resource.version" }}
{{- if (eq . "Service") or (eq . "Secret") }}
apiVersion: v1
{{- else }}
apiVersion: apps/v1
{{- end }}
{{ end }}

{{ define "resource.version" }}
{{- if (eq . "Service") or (eq . "Secret") }}
apiVersion: v1
{{- else }}
apiVersion: apps/v1
{{- end }}
{{ end }}

{{ define "resource.metadata.named" }}
{{- $env := (index . 0) }}
name: "{{ index . 1 }}"
{{ include "namespace.tag" $env | trim }}
labels:
{{- include "labels" $env | trim | nindent 2 }}
{{ end }}
