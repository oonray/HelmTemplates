{{ define "volumes" }}
{{- range $item := (index . 1) }}
    {{- if eq $item.type "secret" }}
{{ include "volume.secret" (list $ $item) }}
    {{- else }}
{{ include "volume.pvc" $item }}
    {{ end }}
{{ end }}
{{ end }}

{{ define "volume" }}
{{- $vol := index . 1}}
{{- include "resource.named" (list (index . 0) "PersistentVolumeClaim" $vol.claim ) | nindent 2 }}
spec:
  storageClassName: {{ $vol.class }}
  accessModes:
{{ $vol.access | toYaml | nindent 4 }}
  resources:
    requests:
      storage: {{ $vol.size }}
{{ end }}

{{ define "volume.pvc" }}
- name: {{ .name }}
  persistentVolumeClaim:
    claimName: {{ .claim }}
{{ end }}

{{ define "volume.secret" }}
{{- $env := index . 0}}
{{- $item := index . 1}}
- name: {{ $item.name }}
  secret:
    secretName: {{ $env.Chart.Name }}-{{ $item.name }}-{{ $env.Values.environment }}
  items:
  {{ $item.items | toYaml | nindent 6 }}
{{ end }}
