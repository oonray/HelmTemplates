{{ define "services" }}
{{- range $cnt := .Values.containers }}
{{ include "service" (slice $ $cnt) }}
{{- end }}
{{ end }}

{{ define "service" }}
{{ $cnt := index . 1}}
---
{{- include "resource" (slice . "Service" ) | nindent 2 }}
spec:
  selector:
{{ include "labels" (index . 0) | nindent 4 }}
  ports:
  {{- range $port := $cnt.ports }}
{{ toYaml $port | nindent 4 }}
  {{- end }}
{{- if hasKey $cnt "service" }}
    {{- if hasKey $cnt.service "type" }}
  type: {{ $cnt.service.type }}
    {{- end }}
{{- end }}
{{ end }}

