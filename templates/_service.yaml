{{ define "services" }}
{{- range $cnt := .Values.containers }}
    {{- if hasKey $cnt "ports" }}
{{ include "service" (list $ $cnt) }}
    {{- end }}
{{- end }}
{{ end }}

{{ define "service" }}
{{ $cnt := index . 1}}
---
{{- include "resource.named" (list (index . 0) "Service" $cnt.name ) }}
spec:
  selector:
{{ include "labels" (index . 0) | nindent 4 }}
  ports:
  {{- range $port := $cnt.ports }}
{{ toYaml $port | nindent 4 }}
  {{- end }}
{{- if hasKey $cnt "service" }}
    {{- if hasKey $cnt.service "type" }}
  type: {{ $cnt.service.type }}
    {{- end }}
{{- end }}
{{ end }}

